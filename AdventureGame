package JocNau;

import java.util.ArrayList;
import java.util.Scanner;

public class AdventureGame {
    private Map m;
    private Player player;
    private Enemy enemy;
    private Scanner scanner;
    private iHall hall;
    private Tripulant tripulant;


    public static void main(String[] args) {
        AdventureGame game = new AdventureGame();
        game.iniciarJuego();
    }

    public AdventureGame() {
        m = new Map();
        player = new Player("Hero", m.getRoom(8));
        enemy = new Enemy("Gonzalin", 6);
        hall = new iHall();
        tripulant = new Tripulant();
        scanner = new Scanner(System.in);
    }

    public void iniciarJuego() {
        buclePrincipal();
    }

    public void buclePrincipal() {
        while (true) {
            System.out.println("\nEstás en: " + player.getCurrentRoom().getName());
            System.out.println(player.getCurrentRoom().getDescription());
            System.out.println("Que quieres hacer: IR, AGARRAR, DEJAR, USAR, DESPERTAR, IHALL, SALIR");

            String input = scanner.nextLine().toUpperCase();
            switch (input) {
                case "IR":
                    System.out.println("¿Hacia dónde quieres ir? (1.up, 2.down, 3.left, 4.right): ");
                    String direction = scanner.nextLine().toLowerCase();
                    player.movePlayer(direction, m);
                    enemy.moveEnemy(direction, m);
                    enemy.atacar();
                    break;

                case "AGARRAR":
                    Room currentRoom = player.getCurrentRoom();
                    if (currentRoom.getItems().isEmpty() || currentRoom == m.getRoom(8)|| currentRoom == m.getRoom(0) && player.hasTarjeta() == false) {
                        System.out.println("No hay objetos en esta habitación para agarrar.");
                    } else {
                        System.out.println("Objetos disponibles en esta habitación:");
                        for (int i = 0; i < currentRoom.getItems().size(); i++) {
                            System.out.println((i + 1) + ". " + currentRoom.getItems().get(i).getName());
                        }

                        System.out.println("¿Qué objeto quieres agarrar? (Ingresa el número correspondiente): ");
                        int itemIndex = scanner.nextInt();
                        scanner.nextLine();

                        if (itemIndex > 0 && itemIndex <= currentRoom.getItems().size()) {
                            Item itemToGrab = currentRoom.getItems().get(itemIndex - 1);
                            player.addItem(itemToGrab);
                            currentRoom.removeItem(itemToGrab);

                            System.out.println("Has agarrado: " + itemToGrab.getName());
                        } else {
                            System.out.println("Número inválido, intenta de nuevo.");
                        }
                    }
                    break;

                case "DEJAR":
                    if (player.getInventory().isEmpty()) {
                        System.out.println("Tu inventario está vacío. No puedes dejar ningún objeto.");
                    } else {
                        System.out.println("Tu inventario contiene los siguientes objetos:");
                        ArrayList<Item> inventory = player.getInventory();
                        for (int i = 0; i < inventory.size(); i++) {
                            System.out.println((i + 1) + ". " + inventory.get(i).getName());
                        }

                        System.out.println("¿Qué objeto quieres dejar en esta habitación? (Ingresa el número correspondiente): ");
                        int itemIndex = scanner.nextInt();
                        scanner.nextLine();

                        if (itemIndex > 0 && itemIndex <= inventory.size()) {
                            Item itemToLeave = inventory.get(itemIndex - 1);
                            player.removeItem(itemToLeave);
                            player.getCurrentRoom().addItem(itemToLeave);

                            System.out.println("Has dejado: " + itemToLeave.getName() + " en la habitación.");
                        } else {
                            System.out.println("Número inválido, intenta de nuevo.");
                        }
                    }
                    break;

                case "USAR":
                    // Mostrar el inventario del jugador
                    if (player.getInventory().isEmpty()) {
                        System.out.println("No tienes objetos en tu inventario para usar.");
                    } else {
                        System.out.println("Tu inventario contiene:");	
                        player.showInventory();

                        // Solicitar al jugador que elija un objeto para usar
                        System.out.println("¿Qué objeto quieres usar?");
                        String objetoAUsar = scanner.nextLine().toLowerCase();

                        // Verificar si el jugador tiene el objeto y usarlo
                        switch (objetoAUsar) {
                            case "linterna":
                                if (player.getInventory().stream().anyMatch(item -> item.getName().equalsIgnoreCase("Linterna"))) {
                                    if (!player.hasFlashlightOn()) {
                                        player.setFlashlightOn(true); // Activar linterna
                                        System.out.println("Has encendido la linterna. Ahora puedes ver en lugares oscuros.");
                                    } else {
                                        System.out.println("Ya tienes la linterna encendida.");
                                    }
                                } else {
                                    System.out.println("No tienes una linterna en tu inventario.");
                                }
                                break;

                            case "traje":
                                if (player.getInventory().stream().anyMatch(item -> item.getName().equalsIgnoreCase("Traje"))) {
                                    if (!player.hasSuit()) {
                                        player.setSuit(true); // Ponerse el traje
                                        System.out.println("Te has puesto el traje espacial. Ahora puedes salir al exterior.");
                                    } else {
                                        System.out.println("Ya tienes puesto el traje espacial.");
                                    }
                                } else {
                                    System.out.println("No tienes un traje en tu inventario.");
                                }
                                break;

                            case "tarjeta":
                                // Lógica para la tarjeta
                                if (player.getInventory().stream().anyMatch(item -> item.getName().equalsIgnoreCase("Tarjeta"))) {
                                    System.out.println("Has usado la tarjeta para abrir una taquilla.");
                                    // Aquí podrías agregar más lógica relacionada con la tarjeta
                                } else {
                                    System.out.println("No tienes una tarjeta en tu inventario.");
                                }
                                break;
                            case "herramienta":
                                // Lógica para la herramienta
                                if (player.getInventory().stream().anyMatch(item -> item.getName().equalsIgnoreCase("Herramienta"))) {
                                    System.out.println("Has usado la herramienta para arreglar los propulsores.");
                                    // Aquí puedes agregar lógica específica si arregla los propulsores, por ejemplo.
                                } else {
                                    System.out.println("No tienes una herramienta en tu inventario.");
                                }
                                break;

                            case "donut":
                                // Lógica para el donut
                                if (player.getInventory().stream().anyMatch(item -> item.getName().equalsIgnoreCase("Donut"))) {
                                    System.out.println("Le has dado el donut a Gonzalin, ahora está calmado.");
                                    // Aquí podrías agregar lógica para que Gonzalin desaparezca o algo similar.
                                } else {
                                    System.out.println("No tienes un donut en tu inventario.");
                                }
                                break;

                            default:
                                System.out.println("No tienes ese objeto o no es usable.");
                                break;
                        }
                    }
                    break;


                case "DESPERTAR":
                    if(player.getCurrentRoom()!= m.getRoom(8)) {
                    	System.out.println("No hay nadie que puedas despertar aqui");
                    }
                    else {
                    	tripulant.askForCard();
                    	currentRoom = player.getCurrentRoom();
                        if (currentRoom.getItems().isEmpty()) {
                            System.out.println("No hay objetos en esta habitación para agarrar.");
                        } else {
                            System.out.println("Ten capitan cogela");
                            for (int i = 0; i < currentRoom.getItems().size(); i++) {
                                System.out.println((i + 1) + ". " + currentRoom.getItems().get(i).getName());
                            }
                    	System.out.println("Quieres agarrarlo? (Ingresa el número correspondiente): ");
                        int itemIndex = scanner.nextInt();
                        scanner.nextLine();
                    	if (itemIndex > 0 && itemIndex <= currentRoom.getItems().size()) {
                            Item itemToGrab = currentRoom.getItems().get(itemIndex - 1);
                            player.addItem(itemToGrab);
                            currentRoom.removeItem(itemToGrab);

                            System.out.println("Has agarrado: " + itemToGrab.getName());
                        } else {
                            System.out.println("Número inválido, intenta de nuevo.");
                        }

                    	
                    }}
                    break;
                case "IHALL":
                    hall.askForObject(player, m);
                    break;
                    
                

                case "SALIR":
                    restartGame();
                    break;

                default:
                    System.out.println("No se ha entendido la palabra introducida, introduce una válida.");
                    break;
            }
        }
    }

    public void restartGame() {
        System.out.println("¿Quieres reiniciar el juego? (si/no)");
        String resposta = scanner.nextLine();

        if (resposta.equalsIgnoreCase("no")) {
            System.out.println("¡Gracias por jugar!");
            scanner.close();
            System.exit(0);
        } else if (resposta.equalsIgnoreCase("si")) {
            iniciarJuego();
        } else {
            System.out.println("Respuesta no válida. Por favor, escribe 'si' o 'no'.");
            restartGame();
        }
    }
}
